# Генерация датасета для RenderFormer

Этот скрипт генерирует синтетический датасет для обучения модели RenderFormer.

## Требования

- Python 3.10+
- Blender 4.2+
- blenderproc

## Установка

1. Активируйте виртуальное окружение:
```bash
source .venv/bin/activate
```

2. Убедитесь, что blenderproc установлен:
```bash
pip install blenderproc
```

## Использование

### Быстрый запуск (с простыми примитивами)

Если у вас нет моделей Objaverse, скрипт автоматически создаст простые геометрические примитивы:

```bash
blenderproc run generate_dataset.py
```

### С моделями Objaverse

1. Скачайте модели Objaverse и поместите их в папку `objaverse_models/`
2. Запустите скрипт:
```bash
blenderproc run generate_dataset.py
```

## Конфигурация

Основные параметры можно изменить в функции `generate_dataset()`:

- `NUM_SCENES`: количество сцен для генерации (по умолчанию: 10)
- `MAX_TRIANGLES`: максимальное количество треугольников на объект (по умолчанию: 4096)
- `RESOLUTION`: разрешение рендера (по умолчанию: 512)
- `SAMPLES`: количество сэмплов для Cycles (по умолчанию: 128)
- `OBJAVERSE_PATH`: путь к папке с моделями Objaverse

## Выходные данные

Скрипт создает папку `renderformer_dataset/` со следующей структурой:

```
renderformer_dataset/
├── scene_0/
│   ├── metadata.json
│   └── scene.hdf5
├── scene_1/
│   ├── metadata.json
│   └── scene.hdf5
└── ...
```

### Формат метаданных

Каждый файл `metadata.json` содержит:

```json
{
  "camera_pose": [[...], [...], [...], [...]],
  "light_positions": [[x, y, z], ...],
  "light_energies": [energy1, energy2, ...],
  "template_type": "ground+back",
  "objects": ["object1", "object2", ...],
  "used_objaverse": false
}
```

## Особенности

- **Автоматическое переключение**: Если папка `objaverse_models` не существует, скрипт автоматически создает простые примитивы
- **Случайные материалы**: Каждый объект имеет 50% шанс получить случайный материал с GGX BRDF
- **Разнообразные сцены**: Случайное количество объектов (1-3), случайные позиции камеры и освещения
- **Шаблоны сцен**: Поддержка различных комбинаций стен и пола

## Устранение неполадок

### Ошибка "set_fov"
Исправлено в текущей версии - используется правильный API для установки FOV.

### Ошибка "rotate_euler"
Исправлено в текущей версии - используется `set_rotation_euler`.

### Медленная генерация
Уменьшите параметры:
- `NUM_SCENES`: меньше сцен
- `SAMPLES`: меньше сэмплов для рендера
- `RESOLUTION`: меньшее разрешение

## Пример использования

```python
# Генерация 5 сцен с высоким качеством
config = {
    "NUM_SCENES": 5,
    "RESOLUTION": 1024,
    "SAMPLES": 512
}
``` 